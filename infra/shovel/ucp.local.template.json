{
  "pg_url": "${SHOVEL_PG_URL}",
  "eth_sources": [
    {
      "name": "local",
      "chain_id": "${CHAIN_ID}",
      "urls": ["${ETH_RPC_URL}"]
    }
  ],
  "integrations": [
    {
      "name": "erc8004_identity_registry",
      "enabled": true,
      "sources": [{ "name": "local", "start": "${SHOVEL_START_BLOCK}" }],
      "table": {
        "name": "erc8004_identity_events",
        "columns": [
          { "name": "chain_id", "type": "numeric" },
          { "name": "block_num", "type": "numeric" },
          { "name": "tx_hash", "type": "bytea" },
          { "name": "log_idx", "type": "numeric" },
          { "name": "registry", "type": "bytea" },
          { "name": "agent_id", "type": "numeric" },
          { "name": "agent_domain", "type": "text" },
          { "name": "agent_address", "type": "bytea" }
        ]
      },
      "block": [
        { "name": "chain_id", "column": "chain_id" },
        { "name": "block_num", "column": "block_num" },
        { "name": "tx_hash", "column": "tx_hash" },
        { "name": "log_idx", "column": "log_idx" },
        {
          "name": "log_addr",
          "column": "registry",
          "filter_op": "contains",
          "filter_arg": ["${IDENTITY_REGISTRY_ADDRESS}"]
        }
      ],
      "event": {
        "type": "event",
        "name": "${EVENT_NAME}",
        "anonymous": false,
        "inputs": [
          { "indexed": true, "name": "agentId", "type": "uint256", "column": "agent_id" },
          { "indexed": true, "name": "agentDomain", "type": "string", "column": "agent_domain" },
          { "indexed": true, "name": "agentAddress", "type": "address", "column": "agent_address" }
        ]
      }
    },
    {
      "name": "commerce_payments_auth_capture_escrow",
      "enabled": true,
      "sources": [{ "name": "local", "start": "${PAYMENTS_START_BLOCK}" }],
      "table": {
        "name": "commerce_payments_captures",
        "columns": [
          { "name": "chain_id", "type": "numeric" },
          { "name": "block_num", "type": "numeric" },
          { "name": "tx_hash", "type": "bytea" },
          { "name": "log_idx", "type": "numeric" },
          { "name": "escrow", "type": "bytea" },
          { "name": "payment_info_hash", "type": "bytea" },
          { "name": "amount", "type": "numeric" },
          { "name": "fee_bps", "type": "numeric" },
          { "name": "fee_receiver", "type": "bytea" }
        ]
      },
      "block": [
        { "name": "chain_id", "column": "chain_id" },
        { "name": "block_num", "column": "block_num" },
        { "name": "tx_hash", "column": "tx_hash" },
        { "name": "log_idx", "column": "log_idx" },
        {
          "name": "log_addr",
          "column": "escrow",
          "filter_op": "contains",
          "filter_arg": ["${PAYMENTS_ESCROW_ADDRESS}"]
        }
      ],
      "event": {
        "type": "event",
        "name": "${PAYMENTS_EVENT_NAME}",
        "anonymous": false,
        "inputs": [
          { "indexed": true, "name": "paymentInfoHash", "type": "bytes32", "column": "payment_info_hash" },
          { "indexed": false, "name": "amount", "type": "uint256", "column": "amount" },
          { "indexed": false, "name": "feeBps", "type": "uint16", "column": "fee_bps" },
          { "indexed": false, "name": "feeReceiver", "type": "address", "column": "fee_receiver" }
        ]
      }
    }
  ]
}
